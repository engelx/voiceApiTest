<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador de Web Speech API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ocultar scrollbar para un diseño más limpio */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8 font-sans">

    <div class="max-w-5xl mx-auto space-y-6">
        <header class="border-b border-gray-700 pb-4">
            <h1 class="text-3xl font-bold text-white">Explorador de Voces (SpeechSynthesis)</h1>
            <p class="text-gray-400 text-sm mt-1">Inspecciona y prueba las voces disponibles en tu entorno actual.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Controles y Selección -->
            <div class="lg:col-span-2 space-y-6">
                
                <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-sm">
                    <label class="block text-sm font-semibold text-gray-300 mb-2" for="voiceSelect">Selecciona una Voz:</label>
                    <select id="voiceSelect" class="w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="">Cargando voces...</option>
                    </select>
                </div>

                <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-sm space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2" for="textInput">Texto a pronunciar:</label>
                        <textarea id="textInput" rows="4" class="w-full bg-gray-900 text-white border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-blue-500 outline-none resize-none">La ignorancia afirma o niega rotundamente; la ciencia duda.</textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Tono (Pitch)</span> <span id="pitchVal">1.0</span>
                            </label>
                            <input type="range" id="pitch" min="0" max="2" value="1" step="0.1" class="w-full accent-blue-500">
                        </div>
                        <div>
                            <label class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Velocidad (Rate)</span> <span id="rateVal">1.0</span>
                            </label>
                            <input type="range" id="rate" min="0.1" max="10" value="1" step="0.1" class="w-full accent-blue-500">
                        </div>
                        <div>
                            <label class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Volumen (Volume)</span> <span id="volumeVal">1.0</span>
                            </label>
                            <input type="range" id="volume" min="0" max="1" value="1" step="0.1" class="w-full accent-blue-500">
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 pt-2">
                        <button id="btnPlay" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition-colors">Hablar</button>
                        <button id="btnPause" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold rounded-md transition-colors">Pausar</button>
                        <button id="btnResume" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md transition-colors">Reanudar</button>
                        <button id="btnCancel" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-md transition-colors">Cancelar</button>
                    </div>
                </div>

            </div>

            <!-- Detalles y Eventos -->
            <div class="space-y-6">
                
                <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-sm">
                    <h2 class="text-sm font-semibold text-gray-300 mb-3 border-b border-gray-700 pb-2">Detalles de la Voz</h2>
                    <ul id="voiceDetails" class="text-sm text-gray-400 space-y-2 break-all">
                        <li>Selecciona una voz para ver sus detalles.</li>
                    </ul>
                </div>

                <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-sm flex flex-col h-64">
                    <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-3">
                        <h2 class="text-sm font-semibold text-gray-300">Registro de Eventos</h2>
                        <button id="btnClearLog" class="text-xs text-gray-500 hover:text-white">Limpiar</button>
                    </div>
                    <div id="eventLog" class="flex-1 overflow-y-auto no-scrollbar text-xs font-mono space-y-1">
                        <!-- Los eventos aparecerán aquí -->
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const synth = window.speechSynthesis;
        const voiceSelect = document.getElementById('voiceSelect');
        const textInput = document.getElementById('textInput');
        const voiceDetails = document.getElementById('voiceDetails');
        const eventLog = document.getElementById('eventLog');
        
        // Sliders
        const pitch = document.getElementById('pitch');
        const rate = document.getElementById('rate');
        const volume = document.getElementById('volume');
        
        // Displays de valores
        const pitchVal = document.getElementById('pitchVal');
        const rateVal = document.getElementById('rateVal');
        const volumeVal = document.getElementById('volumeVal');

        let voices = [];

        function logEvent(name, detail = '') {
            const time = new Date().toLocaleTimeString('es-ES', { hour12: false, fractionalSecondDigits: 3 });
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-gray-500">[${time}]</span> <span class="text-blue-400 font-bold">${name}</span> <span class="text-gray-300">${detail}</span>`;
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        function populateVoiceList() {
            voices = synth.getVoices();
            voiceSelect.innerHTML = '';
            
            if (voices.length === 0) {
                const option = document.createElement('option');
                option.textContent = 'No se encontraron voces.';
                voiceSelect.appendChild(option);
                return;
            }

            voices.forEach((voice, i) => {
                const option = document.createElement('option');
                option.textContent = `${voice.name} (${voice.lang})`;
                if (voice.default) option.textContent += ' — DEFAULT';
                option.value = i;
                voiceSelect.appendChild(option);
            });

            updateVoiceDetails();
            logEvent('Sistema', `Cargadas ${voices.length} voces.`);
        }

        function updateVoiceDetails() {
            const selectedIndex = voiceSelect.value;
            if (selectedIndex === '' || voices.length === 0) return;
            
            const v = voices[selectedIndex];
            voiceDetails.innerHTML = `
                <li><strong class="text-gray-200">Nombre:</strong> ${v.name}</li>
                <li><strong class="text-gray-200">Idioma:</strong> ${v.lang}</li>
                <li><strong class="text-gray-200">Servicio Local:</strong> <span class="${v.localService ? 'text-green-400' : 'text-yellow-400'}">${v.localService}</span></li>
                <li><strong class="text-gray-200">Por defecto:</strong> <span class="${v.default ? 'text-green-400' : 'text-gray-500'}">${v.default}</span></li>
                <li><strong class="text-gray-200">URI:</strong> ${v.voiceURI}</li>
            `;
        }

        function speak() {
            if (synth.speaking) {
                logEvent('Error', 'Ya hay una reproducción en curso.');
                return;
            }
            if (textInput.value === '') {
                logEvent('Error', 'El campo de texto está vacío.');
                return;
            }

            const utterThis = new SpeechSynthesisUtterance(textInput.value);
            const selectedOption = voiceSelect.value;
            
            if (selectedOption !== '') {
                utterThis.voice = voices[selectedOption];
            }

            utterThis.pitch = parseFloat(pitch.value);
            utterThis.rate = parseFloat(rate.value);
            utterThis.volume = parseFloat(volume.value);

            // Registro de eventos del Utterance
            utterThis.onstart = (e) => logEvent('onstart', 'Inició la reproducción.');
            utterThis.onend = (e) => logEvent('onend', `Terminó tras ${e.elapsedTime}ms.`);
            utterThis.onerror = (e) => logEvent('onerror', `Error: ${e.error}`);
            utterThis.onpause = (e) => logEvent('onpause', 'Reproducción pausada.');
            utterThis.onresume = (e) => logEvent('onresume', 'Reproducción reanudada.');
            utterThis.onmark = (e) => logEvent('onmark', `Marca alcanzada: ${e.name}`);
            utterThis.onboundary = (e) => logEvent('onboundary', `Límite tipo '${e.name}' en índice ${e.charIndex}.`);

            synth.speak(utterThis);
            logEvent('Comando', 'speak() invocado.');
        }

        // Listeners
        populateVoiceList();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        voiceSelect.addEventListener('change', updateVoiceDetails);

        pitch.addEventListener('input', () => pitchVal.textContent = pitch.value);
        rate.addEventListener('input', () => rateVal.textContent = rate.value);
        volume.addEventListener('input', () => volumeVal.textContent = volume.value);

        document.getElementById('btnPlay').addEventListener('click', speak);
        
        document.getElementById('btnPause').addEventListener('click', () => {
            if(synth.speaking && !synth.paused) {
                synth.pause();
                logEvent('Comando', 'pause() invocado.');
            }
        });
        
        document.getElementById('btnResume').addEventListener('click', () => {
            if(synth.paused) {
                synth.resume();
                logEvent('Comando', 'resume() invocado.');
            }
        });
        
        document.getElementById('btnCancel').addEventListener('click', () => {
            synth.cancel();
            logEvent('Comando', 'cancel() invocado.');
        });

        document.getElementById('btnClearLog').addEventListener('click', () => {
            eventLog.innerHTML = '';
        });

    </script>
</body>
</html>
